# 要件文書

## 概要

プレイヤーが「物語の主人公」になる体験に完全に没入できる、次世代のAI駆動型TRPGプラットフォーム。従来のツールが要求する複雑な事前設定を排除し、プレイヤーが創造的なロールプレイそのものに集中できるシームレスな環境を提供する。

## 要件

### 要件1：キャンペーン管理システム

**ユーザーストーリー：** プレイヤーとして、物語の進行状況を永続的に保存し、いつでも中断・再開できるようにしたい。そうすることで、長期間にわたる物語を楽しむことができる。

#### 受け入れ基準

1. WHEN プレイヤーがシナリオ設定ファイルを選択 THEN システムは新しいキャンペーンを作成する
2. WHEN キャンペーンが進行中 THEN システムはキャラクターの状態タグ、世界の状況、会話履歴を自動的に保存する
3. WHEN プレイヤーが過去のキャンペーンを選択 THEN システムは完全に同じ状態からゲームを再開する
4. WHEN セッションが終了 THEN システムは全ての状態を永続化ストレージに保存する

### 要件2：シナリオ設定システム

**ユーザーストーリー：** プレイヤーとして、JSONファイルを直接編集することなく、直感的なUIでシナリオ設定を行いたい。そうすることで、技術的な知識がなくても多様な物語設定を楽しめる。

#### 受け入れ基準

1. WHEN プレイヤーがシナリオ設定画面にアクセス THEN システムはWebフォーム形式のUIを表示する
2. WHEN プレイヤーがGMの性格を設定 THEN システムはその設定をscenario_settings.jsonに反映する
3. WHEN プレイヤーが世界の雰囲気を設定 THEN システムはその設定をscenario_settings.jsonに反映する
4. WHEN プレイヤーが物語の導入部を設定 THEN システムはその設定をscenario_settings.jsonに反映する
5. WHEN 設定が完了 THEN システムは設定内容を検証し、キャンペーン作成を可能にする

### 要件3：コアゲームプレイシステム

**ユーザーストーリー：** プレイヤーとして、自由な自然言語でキャラクターの行動を宣言し、AIゲームマスターとリアルタイムに対話したい。そうすることで、ルールに縛られない自由な物語体験ができる。

#### 受け入れ基準

1. WHEN プレイヤーが自然言語で行動を入力 THEN システムはその行動を受け付ける
2. WHEN プレイヤーが行動を宣言 THEN AIゲームマスター（Inworld AI または代替AIサービス）は現在の状態タグを考慮して難易度（1-100の目標値）を決定する
3. WHEN 難易度が決定 THEN システムはその判定理由をプレイヤーに提示する
4. WHEN 判定が必要 THEN システムはd100ダイス（1-100の乱数）をロールし、結果が目標値以下であれば成功と判定する
5. WHEN 判定結果が確定 THEN AIゲームマスターは結果に基づいて物語の展開を描写する
6. WHEN 物語が展開 THEN システムは状況に応じて状態タグを動的に追加・削除する

### 要件4：状態タグ管理システム

**ユーザーストーリー：** プレイヤーとして、キャラクターの状態を数値ではなく記述的なタグで管理したい。そうすることで、より物語的で直感的なキャラクター状態の把握ができる。

#### 受け入れ基準

1. WHEN キャラクターに変化が生じる THEN システムは適切な状態タグを追加する
2. WHEN 状態タグが不要になる THEN システムは該当するタグを削除する
3. WHEN プレイヤーが状態を確認 THEN システムは現在の全ての状態タグを表示する
4. WHEN 状態タグが行動に影響する THEN GMはそれを難易度判定に反映する

### 要件5：ユーザーインターフェース

**ユーザーストーリー：** プレイヤーとして、物語への没入を妨げないシンプルで直感的なUIを使いたい。そうすることで、ゲームメカニクスではなく物語そのものに集中できる。

#### 受け入れ基準

1. WHEN プレイヤーがゲーム画面にアクセス THEN システムはチャットログを中心としたレイアウトを表示する
2. WHEN ゲームが進行中 THEN システムはキャラクターの状態タグを常に確認できる位置に表示する
3. WHEN プレイヤーが行動を入力 THEN システムは自然言語入力フィールドを提供する
4. WHEN GMが応答 THEN システムは物語の描写を読みやすい形式で表示する

### 要件6：AIサービス統合

**ユーザーストーリー：** システム管理者として、高度なAIエージェント機能を持つ統合システムを構築したい。そうすることで、効率的で拡張可能なAI-TRPGプラットフォームを提供できる。

#### 受け入れ基準

1. WHEN システムが初期化される THEN Mastra AI フレームワークを使用してGMエージェントを構築する
2. WHEN プレイヤーが行動を入力 THEN システムはエージェント・ワークフロー・ツールを統合して処理する
3. WHEN ゲームが進行する THEN システムはRAGシステムを使用して関連知識を検索・統合する
4. WHEN ゲーム状態が変化 THEN システムは内蔵メモリ機能を使用して状態を永続化する
5. WHEN 新しいLLMプロバイダーを追加 THEN Mastraの統一インターフェースを通じて統合できる

### 要件7：パフォーマンスとセキュリティ

**ユーザーストーリー：** プレイヤーとして、遅延のない応答と安全なデータ管理を期待する。そうすることで、安心してリアルタイムな対話体験を楽しめる。

#### 受け入れ基準

1. WHEN プレイヤーが行動を入力 THEN システムは3秒以内にGMの応答を開始する
2. WHEN APIキーが必要 THEN システムはフロントエンドに露出させることなくバックエンドで管理する
3. WHEN データが保存される THEN システムは暗号化された形式で永続化する
4. WHEN システムが拡張される THEN 既存機能に影響を与えることなく新機能を追加できる